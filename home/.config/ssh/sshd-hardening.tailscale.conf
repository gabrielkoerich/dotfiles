# Dotfiles SSH hardening (Tailscale-only profile)
# Copy this to: /etc/ssh/sshd_config.d/99-tailscale-hardening.conf
# Replace __SSH_USER__ with your macOS username.

Protocol 2
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
KbdInteractiveAuthentication no
ChallengeResponseAuthentication no
UsePAM yes

# Restrict SSH user and make key auth mandatory.
AllowUsers __SSH_USER__
AuthenticationMethods publickey

# Disable forwarding/tunnels unless explicitly required.
X11Forwarding no
AllowTcpForwarding no
AllowAgentForwarding no
PermitTunnel no

# Keep stale mobile sessions from hanging forever.
ClientAliveInterval 120
ClientAliveCountMax 2

# Allow this user only from Tailscale ranges.
Match Address *,!100.64.0.0/10,!fd7a:115c:a1e0::/48
  DenyUsers __SSH_USER__

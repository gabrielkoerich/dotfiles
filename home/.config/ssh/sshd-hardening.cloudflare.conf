# Dotfiles SSH hardening (Cloudflare Tunnel profile)
# Copy this to: /etc/ssh/sshd_config.d/99-cloudflare-hardening.conf
# Replace __SSH_USER__ with your macOS username.
#
# Cloudflare Tunnel (cloudflared) proxies SSH traffic through Cloudflare's
# network, so sshd only needs to listen on localhost. No ports are exposed
# to the public internet.

Protocol 2
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
KbdInteractiveAuthentication no
ChallengeResponseAuthentication no
UsePAM yes

# Listen only on localhost â€” cloudflared connects locally.
ListenAddress 127.0.0.1
ListenAddress ::1

# Reduce brute-force surface (defense-in-depth).
MaxAuthTries 3
LoginGraceTime 20
MaxSessions 5
MaxStartups 10:30:60

# Restrict SSH to a specific user.
AllowUsers __SSH_USER__
AuthenticationMethods publickey

# Disable forwarding/tunnels unless explicitly required.
X11Forwarding no
AllowTcpForwarding no
AllowAgentForwarding no
PermitTunnel no

# Keep stale mobile sessions from hanging forever.
ClientAliveInterval 120
ClientAliveCountMax 2
